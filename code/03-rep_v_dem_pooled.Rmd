---
title: "02-Republican_v_Democrat_Overall"
author: "Christopher Soria"
date: "2024-01-30"
output: html_document
---
```{r}
library(sjPlot)
library(MASS)
library(tidyverse)

emm_options(rg.limit = 25000)
```


First, I want to find out who was more likely to say that they reduced contact throughout the pandemic
clustering of errors?
controlling for state?
controlling for binary state variables?
Cluster errors by wave?
```{r}
rvd_contact_reduction_model <- lm(contact_reduction ~  log_rate_prev_12_01_20 + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + political_party + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, 
                                   data = bics_zip_features,
                                   weights = weight_pooled)

rvd_contact_reduction_plot <- plot_model(
  rvd_contact_reduction_model,
  colors = "black",
  type = "pred",
  auto.label = FALSE,
  terms = c("political_party[Democrat, Republican, Independent]"),
  title = "Partisan Differences in Contact Reduction Throughout \nthe Pandemic",
  axis.title = c("", "Predicted Probability of Contact Reduction")
) +
theme_minimal() +
  theme(
    legend.position = "none",
    axis.text.y = element_text(size = 20), 
    axis.title.y = element_text(size = 20), 
    axis.text.x = element_text(size = 14), 
    axis.title.x = element_text(size = 14),  
    plot.title = element_text(size = 28, face = "bold"), 
    plot.subtitle = element_text(size = 15)
  ) +
  geom_point(size = 5) 

ggsave("rvd_contact_reduction_pooled.png", plot = rvd_contact_reduction_plot, path = "/Users/chrissoria/Documents/Research/BICS_Political_Polarization/plots/Contact_Reduction", width = 12, height = 8, units = "in")

summary(rvd_contact_reduction_model)
print(rvd_contact_reduction_plot)

rm(rvd_contact_reduction_model,rvd_contact_reduction_plot)
```
Next, I want to find out who was more concerned about the spread of the virus throughout the pandemic
```{r}
rvd_concern_model <- lm(binary_concern_strong ~  log_current_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + political_party + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, 
                                   data = bics_zip_features, 
                                   weights = weight_pooled)


emm_concern <- emmeans(rvd_concern_model, specs = "political_party")
emm_concern <- transform(summary(emm_concern))

emm_concern <- emm_concern %>% 
  filter(political_party != "Prefer not to answer")

rvd_concern_plot <- ggplot(emm_concern, aes(x = political_party, y = emmean, color = political_party, shape = political_party)) +
  geom_point(position = position_dodge(width = 0.35), size = 4) +
  scale_color_manual(name = "Political Party", values = c("blue", "red", "darkgreen")) +
  labs(y = "Probability of Concern", x = "", color = "Political Party", title = "Predicted Probablity of Being 'Very Concerned' About Spread") +  # Make sure to add your title here
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2, position = position_dodge(width = 0.35)) +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(size = 26),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color = "grey70", size = 0.5),
        panel.grid.major.y = element_line(color = "grey90", size = 0.5),
        axis.title.x = element_text(size = 18),
        axis.text.x = element_text(size = 15),
        axis.title.y = element_text(size = 16),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10)) +
  guides(shape = "none")

ggsave("rvd_concern_pooled.png", plot = rvd_concern_plot, path = "/Users/chrissoria/Documents/Research/BICS_Political_Polarization/plots/Concern", width = 12, height = 8, units = "in")

print(summary(rvd_concern_model))
rvd_concern_plot

rm(rvd_concern_model,rvd_concern_plot)
```
Now, let's take a look at number of non-household contacts glm.nb
```{r}
rvd_contacts_model <- lm(num_cc_nonhh  ~  log_current_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + political_party + r_working + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, 
                                   data = bics_zip_features, 
                                   weights = weight_pooled)

emm_contacts <- emmeans(rvd_contacts_model, specs = "political_party")
emm_contacts <- transform(summary(emm_contacts))

emm_contacts <- emm_contacts %>% 
  filter(political_party != "Prefer not to answer")

rvd_contacts_plot <- ggplot(emm_contacts, aes(x = political_party, y = emmean, color = political_party, shape = political_party)) +
  geom_point(position = position_dodge(width = 0.35), size = 4) +
  scale_color_manual(name = "Political Party", values = c("blue", "red", "darkgreen")) +
  labs(y = "Predicted Contacts", x = "", color = "Political Party", title = "Predicted Number of Non-Household Contacts") +  # Make sure to add your title here
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2, position = position_dodge(width = 0.35)) +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(size = 26),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color = "grey70", size = 0.5),
        panel.grid.major.y = element_line(color = "grey90", size = 0.5),
        axis.title.x = element_text(size = 18),
        axis.text.x = element_text(size = 15),
        axis.title.y = element_text(size = 16),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10)) +
  guides(shape = "none")

ggsave("rvd_contacts_pooled.png", plot = rvd_contacts_plot, path = "/Users/chrissoria/Documents/Research/BICS_Political_Polarization/plots/Contacts", width = 12, height = 8, units = "in")

rvd_contacts_plot

rm(rvd_contacts_model,rvd_contacts_plot)
```
And lastly, let's see how republicans and democrats differed on mask usage
For now, I'm using a linear model for the sake of making it easy to interpret 
```{r}
rvd_masks_model <- lm(Norm_Masks_Used  ~  log_current_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + political_party + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, 
                                   data = bics_zip_features,
                      weights = weight_pooled)

emm_masks <- emmeans(rvd_masks_model, specs = "political_party")
emm_masks <- transform(summary(emm_masks))

emm_masks <- emm_masks %>% 
  filter(political_party != "Prefer not to answer")

rvd_masks_plot <- ggplot(emm_masks, aes(x = political_party, y = emmean, color = political_party, shape = political_party)) +
  geom_point(position = position_dodge(width = 0.35), size = 4) +
  scale_color_manual(name = "Political Party", values = c("blue", "red", "darkgreen")) +
  labs(y = "Predicted Percentage Masked Contacts", x = "", color = "Political Party", title = "Mask Use Probability in Non-Household Contacts") +  # Make sure to add your title here
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2, position = position_dodge(width = 0.35)) +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(size = 26),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color = "grey70", size = 0.5),
        panel.grid.major.y = element_line(color = "grey90", size = 0.5),
        axis.title.x = element_text(size = 18),
        axis.text.x = element_text(size = 15),
        axis.title.y = element_text(size = 16),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10)) +
  guides(shape = "none")

ggsave("rvd_masks_pooled.png", plot = rvd_masks_plot, path = "/Users/chrissoria/Documents/Research/BICS_Political_Polarization/plots/Masks", width = 12, height = 8, units = "in")

rvd_masks_plot

rm(rvd_masks_model,rvd_masks_plot)
```
Vaccines
```{r}
emm_options(rg.limit = 25000)
rvd_vaccination_model <- lm(Vaccinated  ~  log_current_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + political_party + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta, 
                                   data = bics_zip_features,
                            weights = weight_pooled)

emm_vaccine <- emmeans(rvd_vaccination_model, specs = "political_party")
emm_vaccine <- transform(summary(emm_vaccine))

emm_vaccine <- emm_vaccine %>% 
  filter(political_party != "Prefer not to answer")

rvd_vaccination_plot <- ggplot(emm_vaccine, aes(x = political_party, y = emmean, color = political_party, shape = political_party)) +
  geom_point(position = position_dodge(width = 0.35), size = 4) +
  scale_color_manual(name = "Political Party", values = c("blue", "red", "darkgreen")) +
  labs(y = "Probability of Vaccination", x = "", color = "Political Party", title = "Predicted Probablity of Getting the Vaccine") +  # Make sure to add your title here
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2, position = position_dodge(width = 0.35)) +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(size = 26),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color = "grey70", size = 0.5),
        panel.grid.major.y = element_line(color = "grey90", size = 0.5),
        axis.title.x = element_text(size = 18),
        axis.text.x = element_text(size = 15),
        axis.title.y = element_text(size = 16),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10)) +
  guides(shape = "none")

ggsave("rvd_vaccines_pooled.png", plot = rvd_vaccination_plot, path = "/Users/chrissoria/Documents/Research/BICS_Political_Polarization/plots/Vaccines", width = 12, height = 8, units = "in")

rvd_vaccination_plot

rm(rvd_vaccination_model,rvd_vaccination_plot)
```
Below, I want to find out who is more responsive to incidence rates (democrats or republicans)
After controls, neither is more or less responsive to incidence rates than the other when it comes to mask usage.
```{r}
bi_mask_dem <- lm(Norm_Masks_Used ~ log_prev_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, data = D_df, weights = weight_pooled)
print(summary(bi_mask_dem))

bi_mask_rep <- lm(Norm_Masks_Used ~  log_prev_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, data = R_df, weights = weight_pooled)
print(summary(bi_mask_rep))

bi_mask_ind <- lm(Norm_Masks_Used ~  log_prev_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, data = I_df, weights = weight_pooled)
print(summary(bi_mask_ind))

coef_dem <- summary(bi_mask_dem)$coefficients["log_prev_week_inc_rate", c("Estimate", "Std. Error")]
coef_rep <- summary(bi_mask_rep)$coefficients["log_prev_week_inc_rate", c("Estimate", "Std. Error")]
coef_ind <- summary(bi_mask_ind)$coefficients["log_prev_week_inc_rate", c("Estimate", "Std. Error")]

# Create a data frame for plotting
coef_df <- data.frame(
  political_party = c("Democrat", "Republican", "Independent"),
  Estimate = c(coef_dem[1], coef_rep[1], coef_ind[1]),
  SE = c(coef_dem[2], coef_rep[2], coef_ind[2])
)

coef_df$political_party <- factor(coef_df$political_party, levels = c("Democrat", "Republican", "Independent"))

# Plot
rvd_response_masks_plot <- ggplot(coef_df, aes(x = political_party, y = Estimate, color = political_party, shape = political_party)) +
  geom_point(position = position_dodge(width = 0.35), size = 4) +
  scale_color_manual(name = "Political Party", values = c("Democrat" = "blue", "Republican" = "red", "Independent" = "darkgreen")) +
  labs(y = "Estimated Effect of Log Previous Week Incidence Rate", x = "", title = "Estimated Association Between Incidence Rate and Mask Usage by Party") +
  geom_errorbar(aes(ymin = Estimate - SE, ymax = Estimate + SE), width = 0.2, position = position_dodge(width = 0.35)) +
  theme_minimal() +
  theme(plot.title = element_text(size = 20),
        axis.title.x = element_text(size = 16),
        axis.text.x = element_text(size = 14),
        axis.title.y = element_text(size = 14),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10)) +
  guides(color = "none", shape = "none") +
  scale_y_continuous(limits = c(2, NA))

ggsave("rvd_incidence_response.png", plot = rvd_response_masks_plot, path = "/Users/chrissoria/Documents/Research/BICS_Political_Polarization/plots/Masks", width = 12, height = 8, units = "in")

rvd_response_masks_plot

rm(emm_both,rvd_response_masks_plot)

rm(bi_mask_dem,bi_mask_rep, bi_mask_ind, coef_df)
```
However, when it comes to contact rates Republicans are much more responsive. Where Democrats are more likely to keep rates low.

```{r}
bi_contact_dem <- lm(num_cc_nonhh ~ log_prev_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, data = D_df, weights = weight_pooled)
print(summary(bi_contact_dem))

bi_contact_rep <- lm(num_cc_nonhh ~  log_prev_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, data = R_df, weights = weight_pooled)
print(summary(bi_contact_rep))

bi_contact_ind <- lm(num_cc_nonhh ~  log_prev_week_inc_rate + county_mask_mandate + COUNTY_RUCC_2013 + male + educ_group + resp_yob + resp_hhsize + r_race + cityNY +`cityBay Area` +cityPhiladelphia + cityPhoenix +cityBoston + cityAtlanta + wave, data = I_df, weights = weight_pooled)
print(summary(bi_contact_ind))

coef_dem <- summary(bi_contact_dem)$coefficients["log_prev_week_inc_rate", c("Estimate", "Std. Error")]
coef_rep <- summary(bi_contact_rep)$coefficients["log_prev_week_inc_rate", c("Estimate", "Std. Error")]
coef_ind <- summary(bi_contact_ind)$coefficients["log_prev_week_inc_rate", c("Estimate", "Std. Error")]

# Create a data frame for plotting
coef_df <- data.frame(
  political_party = c("Democrat", "Republican", "Independent"),
  Estimate = c(coef_dem[1], coef_rep[1], coef_ind[1]),
  SE = c(coef_dem[2], coef_rep[2], coef_ind[2])
)

coef_df$political_party <- factor(coef_df$political_party, levels = c("Democrat", "Republican", "Independent"))

# Plot
rvd_response_contacts_plot <- ggplot(coef_df, aes(x = political_party, y = Estimate, color = political_party)) +
  geom_point(position = position_dodge(width = 0.35), size = 4) +
  scale_color_manual(name = "Political Party", values = c("Democrat" = "blue", "Republican" = "red", "Independent" = "darkgreen")) +
  labs(y = "Estimated Effect of Log Previous Week Incidence Rate", x = "", title = "Estimated Association Between Incidence Rate and Non-Household Contacts by Party") +
  geom_errorbar(aes(ymin = Estimate - SE, ymax = Estimate + SE), width = 0.2, position = position_dodge(width = 0.35)) +
  theme_minimal() +
  theme(plot.title = element_text(size = 20),
        axis.title.x = element_text(size = 16),
        axis.text.x = element_text(size = 14),
        axis.title.y = element_text(size = 14),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10)) +
  guides(color = "none", shape = "none")

ggsave("rvd_incidence_response.png", plot = rvd_response_contacts_plot, path = "/Users/chrissoria/Documents/Research/BICS_Political_Polarization/plots/Contacts", width = 12, height = 8, units = "in")

rvd_response_contacts_plot

rm(emm_both,rvd_response_contacts_plot)

rm(bi_contact_dem,bi_contact_rep, bi_contact_ind,coef_df)

```

